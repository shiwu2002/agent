<!--pages/video-call/video-call.wxml-->
<view class="video-call-container">
  <!-- 远程视频 -->
  <view class="remote-video-container">
    <live-player 
      id="remote-video"
      src="{{playerUrl}}" 
      mode="RTC" 
      autoplay 
      muted="{{isMuted}}"
      object-fit="fillCrop"
      bindstatechange="onPlayerStateChange"
      class="remote-video">
    </live-player>
    
    <!-- 远程视频遮罩 -->
    <view class="remote-video-overlay" wx:if="{{callStatus !== 'connected' || !isVideoEnabled}}">
      <view class="remote-user-info">
        <image class="remote-avatar" src="{{targetUserInfo.avatar}}" mode="aspectFill"></image>
        <text class="remote-name">{{targetUserInfo.name}}</text>
      </view>
    </view>
  </view>

  <!-- 本地视频 -->
  <view class="local-video-container">
    <live-pusher 
      id="local-video"
      url="{{pusherUrl}}" 
      mode="RTC" 
      autopush
      muted="{{isMuted}}"
      enable-camera="{{isVideoEnabled}}"
      device-position="{{isFrontCamera ? 'front' : 'back'}}"
      beauty="1"
      whiteness="1"
      aspect="3:4"
      object-fit="fillCrop"
      bindstatechange="onPusherStateChange"
      class="local-video">
    </live-pusher>
    
    <!-- 本地视频遮罩 -->
    <view class="local-video-overlay" wx:if="{{!isVideoEnabled}}">
      <image class="local-avatar" src="{{localUserInfo.avatar}}" mode="aspectFill"></image>
    </view>
  </view>

  <!-- 状态栏 -->
  <view class="status-bar">
    <view class="call-status">
      <text wx:if="{{callStatus === 'connecting'}}" class="status-text">正在连接视频通话...</text>
      <text wx:if="{{callStatus === 'connected'}}" class="status-text">{{callDurationText}}</text>
    </view>
  </view>

  <!-- 控制按钮区域 -->
  <view class="control-area" wx:if="{{showControls}}">
    <view class="control-row">
      <!-- 静音按钮 -->
      <view class="control-item" bindtap="toggleMute">
        <view class="control-button {{isMuted ? 'active' : ''}}">
          <image class="control-icon" src="/pages/images/{{isMuted ? '语音撤回' : '语音'}}.png" mode="aspectFit"></image>
        </view>
        <text class="control-label">{{isMuted ? '取消静音' : '静音'}}</text>
      </view>

      <!-- 视频按钮 -->
      <view class="control-item" bindtap="toggleVideo">
        <view class="control-button {{!isVideoEnabled ? 'active' : ''}}">
          <image class="control-icon" src="/pages/images/{{isVideoEnabled ? '视频' : '更多'}}.png" mode="aspectFit"></image>
        </view>
        <text class="control-label">{{isVideoEnabled ? '关闭视频' : '开启视频'}}</text>
      </view>

      <!-- 切换摄像头按钮 -->
      <view class="control-item" bindtap="switchCamera">
        <view class="control-button">
          <image class="control-icon" src="/pages/images/更多.png" mode="aspectFit"></image>
        </view>
        <text class="control-label">切换摄像头</text>
      </view>

      <!-- 更多按钮 -->
      <view class="control-item" bindtap="toggleControls">
        <view class="control-button">
          <image class="control-icon" src="/pages/images/更多.png" mode="aspectFit"></image>
        </view>
        <text class="control-label">隐藏</text>
      </view>
    </view>

    <!-- 挂断按钮 -->
    <view class="hang-up-row">
      <view class="hang-up-button" bindtap="hangUp">
        <image class="hang-up-icon" src="/pages/images/语音撤回.png" mode="aspectFit"></image>
      </view>
    </view>
  </view>

  <!-- 简化控制界面 -->
  <view class="simple-controls" wx:if="{{!showControls}}">
    <view class="simple-control-item" bindtap="toggleMute">
      <image class="simple-control-icon" src="/pages/images/{{isMuted ? '语音撤回' : '语音'}}.png" mode="aspectFit"></image>
    </view>
    <view class="simple-control-item" bindtap="toggleVideo">
      <image class="simple-control-icon" src="/pages/images/{{isVideoEnabled ? '视频' : '更多'}}.png" mode="aspectFit"></image>
    </view>
    <view class="simple-hang-up" bindtap="hangUp">
      <image class="simple-hang-up-icon" src="/pages/images/语音撤回.png" mode="aspectFit"></image>
    </view>
  </view>
</view>